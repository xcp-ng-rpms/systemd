From 8986b8ccd7ea39d75246b72f497a4131a278f3bb Mon Sep 17 00:00:00 2001
From: Lennart Poettering <lennart@poettering.net>
Date: Mon, 23 Sep 2013 16:02:31 -0500
Subject: [PATCH] cgroup: always enable memory.use_hierarchy= for all cgroups
 in the memory hierarchy

The non-hierarchial mode contradicts the whole idea of a cgroup tree so
let's not support this. In the future the kernel will only support the
hierarchial logic anyway.
---
 src/core/cgroup.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/core/cgroup.c b/src/core/cgroup.c
index 9277dd6..7f29afb 100644
--- a/src/core/cgroup.c
+++ b/src/core/cgroup.c
@@ -678,6 +678,9 @@ int manager_setup_cgroup(Manager *m) {
         /* 6. Figure out which controllers are supported */
         m->cgroup_supported = cg_mask_supported();
 
+        /* 7.  Always enable hierarchial support if it exists... */
+        cg_set_attribute("memory", "/", "memory.use_hierarchy", "1");
+
         return 0;
 }
 
